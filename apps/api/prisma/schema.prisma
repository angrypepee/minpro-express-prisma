generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int        @id @default(autoincrement())
  email        String     @unique
  name         String
  role         Role
  createAt     DateTime   @default(now())
  balance      Float      @default(0)
  referralCode String?    @unique
  referredBy   Int?
  password     String
  attendees    Attendee[]
  events       Event[]    @relation("OrganizedEvents")
  reviews      Review[]
  referrer     User?      @relation("Referrals", fields: [referredBy], references: [id])
  referrals    User[]     @relation("Referrals")

  @@index([referredBy], map: "User_referredBy_fkey")
}

model Event {
  id          Int        @id @default(autoincrement())
  name        String
  date        DateTime
  location    String
  description String
  limit       Int
  organizerId Int
  createdAt    DateTime
  image   String
  attendees   Attendee[]
  organizer   User       @relation("OrganizedEvents", fields: [organizerId], references: [id])
  reviews     Review[]
  tickets     Ticket[]

  @@index([organizerId], map: "Event_organizerId_fkey")
}

model Ticket {
  id      Int    @id @default(autoincrement())
  eventId Int
  type    TicketType
  price   Float? @default(0)
  event   Event  @relation(fields: [eventId], references: [id])

  @@index([eventId], map: "Ticket_eventId_fkey")
}

model Attendee {
  id      Int   @id @default(autoincrement())
  userId  Int
  eventId Int
  event   Event @relation(fields: [eventId], references: [id])
  user    User  @relation(fields: [userId], references: [id])

  @@index([eventId], map: "Attendee_eventId_fkey")
  @@index([userId], map: "Attendee_userId_fkey")
}

model Review {
  id        Int      @id @default(autoincrement())
  userId    Int
  eventId   Int
  rating    Int
  review    String?
  createdAt DateTime @default(now())
  event     Event    @relation(fields: [eventId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@index([eventId], map: "Review_eventID_fkey")
  @@index([userId], map: "Review_userId_fkey")
}

enum Role {
  ORGANIZER
  ATTENDEE
}

enum TicketType {
  VIP
  GENERAL
  EARLY_BIRD
}
